<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mudo Stok Sistemi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ Mudo Stok Sistemi</h1>
        <p class="subtitle">Her ÅŸeyin elbet bir kolayÄ± vardÄ±r...</p>
        
        <form id="stockForm">
            <div class="barcode-scanner">
                <button type="button" id="scannerToggle" class="scanner-toggle">ğŸ“· Barkod TarayÄ±cÄ±sÄ±nÄ± AÃ§</button>
                <div id="barcode-scanner">
                    <div class="scanner-status" id="scannerStatus">Kamera baÅŸlatÄ±lÄ±yor...</div>
                    <div class="scanner-overlay">
                        <div class="scanner-frame">
                            <div class="scanner-corner top-left"></div>
                            <div class="scanner-corner top-right"></div>
                            <div class="scanner-corner bottom-left"></div>
                            <div class="scanner-corner bottom-right"></div>
                            <div class="scanner-line"></div>
                        </div>
                    </div>
                </div>
                <div id="scanner-result" class="scanner-result"></div>
            </div>
            
            <div class="form-group">
                <label for="barcode">Barkod NumarasÄ±:</label>
                <div class="input-container">
                    <input type="number" id="barcode" name="barcode" placeholder="Barkod NumarasÄ±" required>
                    <button type="button" id="pasteBtn" class="paste-btn">ğŸ“‹ YapÄ±ÅŸtÄ±r</button>
                </div>
            </div>
            
            <button type="submit" id="searchBtn">ğŸ” Stok Sorgula</button>
        </form>
        
        <div id="result"></div>
        
        <div class="powered-by">
            Mudo SatÄ±ÅŸ DanÄ±ÅŸmanÄ±: Yakup GÃ¼ndÃ¼z
        </div>
    </div>

    <script>
        let isScanning = false;
        let scannerInitialized = false;
        
        // YapÄ±ÅŸtÄ±rma butonu fonksiyonalitesi
        document.getElementById('pasteBtn').addEventListener('click', async function() {
            const barcodeInput = document.getElementById('barcode');
            const pasteBtn = document.getElementById('pasteBtn');
            
            try {
                // Panodaki metni oku
                const text = await navigator.clipboard.readText();
                
                // Sadece sayÄ±larÄ± al (diÄŸer karakterleri temizle)
                const numbersOnly = text.replace(/\D/g, '');
                
                if (numbersOnly) {
                    barcodeInput.value = numbersOnly;
                    pasteBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    pasteBtn.textContent = 'âœ“ YapÄ±ÅŸtÄ±rÄ±ldÄ±';
                    
                    // 2 saniye sonra orijinal hale dÃ¶ndÃ¼r
                    setTimeout(() => {
                        pasteBtn.style.background = 'linear-gradient(135deg, #17a2b8 0%, #20c997 100%)';
                        pasteBtn.textContent = 'ğŸ“‹ YapÄ±ÅŸtÄ±r';
                    }, 2000);
                    
                    // Input alanÄ±na fokus ver
                    barcodeInput.focus();
                    
                    // Hemen otomatik sorgu baÅŸlat (haneli kontrolÃ¼ yok)
                    setTimeout(() => {
                        document.getElementById('stockForm').dispatchEvent(new Event('submit'));
                    }, 300);
                } else {
                    // SayÄ± yoksa hata gÃ¶ster
                    pasteBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #fd7e14 100%)';
                    pasteBtn.textContent = 'âŒ SayÄ± Yok';
                    
                    setTimeout(() => {
                        pasteBtn.style.background = 'linear-gradient(135deg, #17a2b8 0%, #20c997 100%)';
                        pasteBtn.textContent = 'ğŸ“‹ YapÄ±ÅŸtÄ±r';
                    }, 2000);
                }
                
            } catch (err) {
                console.error('YapÄ±ÅŸtÄ±rma hatasÄ±:', err);
                pasteBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #fd7e14 100%)';
                pasteBtn.textContent = 'âŒ Hata';
                
                setTimeout(() => {
                    pasteBtn.style.background = 'linear-gradient(135deg, #17a2b8 0%, #20c997 100%)';
                    pasteBtn.textContent = 'ğŸ“‹ YapÄ±ÅŸtÄ±r';
                }, 2000);
            }
        });
        
        // Barkod tarayÄ±cÄ± toggle
        document.getElementById('scannerToggle').addEventListener('click', function() {
            const scanner = document.getElementById('barcode-scanner');
            const toggleBtn = document.getElementById('scannerToggle');
            const result = document.getElementById('scanner-result');
            
            if (!isScanning) {
                startBarcodeScanner();
                scanner.style.display = 'block';
                scanner.classList.add('scanning');
                toggleBtn.textContent = 'âŒ TarayÄ±cÄ±yÄ± Kapat';
                toggleBtn.classList.add('active');
                result.style.display = 'none';
                isScanning = true;
            } else {
                stopBarcodeScanner();
                scanner.style.display = 'none';
                scanner.classList.remove('scanning');
                toggleBtn.textContent = 'ğŸ“· Barkod TarayÄ±cÄ±sÄ±nÄ± AÃ§';
                toggleBtn.classList.remove('active');
                isScanning = false;
                scannerInitialized = false;
            }
        });
        
        function updateScannerStatus(message, isReady = false) {
            const status = document.getElementById('scannerStatus');
            status.textContent = message;
            status.className = 'scanner-status ' + (isReady ? 'ready' : '');
        }
        
        function startBarcodeScanner() {
            updateScannerStatus('Kamera baÅŸlatÄ±lÄ±yor...');
            
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#barcode-scanner'),
                    constraints: {
                        width: 640,
                        height: 480,
                        facingMode: "environment"
                    }
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
                decoder: {
                    readers: ["ean_reader"]
                },
                locate: true
            }, function(err) {
                if (err) {
                    console.error('Kamera hatasÄ±:', err);
                    showScannerError('Kamera hatasÄ±');
                    return;
                }
                
                updateScannerStatus('Barkodu tutun', true);
                scannerInitialized = true;
                Quagga.start();
            });
            
            Quagga.onDetected(onBarcodeDetected);
        }
        
        function stopBarcodeScanner() {
            if (Quagga && scannerInitialized) {
                Quagga.stop();
                Quagga.offDetected(onBarcodeDetected);
            }
            updateScannerStatus('Kamera kapatÄ±ldÄ±');
        }
        
        function onBarcodeDetected(result) {
            const code = result.codeResult.code;
            // Hemen kabul et - hiÃ§bir doÄŸrulama yok
            acceptBarcode(code);
        }
        
        function acceptBarcode(code) {
            // Input alanÄ±na barkodu yaz
            document.getElementById('barcode').value = code;
            
            // BaÅŸarÄ± mesajÄ± gÃ¶ster
            const scannerResult = document.getElementById('scanner-result');
            scannerResult.innerHTML = `âœ… Barkod okundu: <strong>${code}</strong>`;
            scannerResult.className = 'scanner-result';
            scannerResult.style.display = 'block';
            
            // TarayÄ±cÄ±yÄ± kapat
            document.getElementById('scannerToggle').click();
            
            // Hemen sorgu yap
            document.getElementById('stockForm').dispatchEvent(new Event('submit'));
        }
        
        function playSuccessSound() {
            // Basit beep sesi oluÅŸtur
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // Ses Ã§alma hatasÄ± - sessizce geÃ§
            }
        }
        
        function showScannerError(message) {
            const scannerResult = document.getElementById('scanner-result');
            scannerResult.innerHTML = `âŒ ${message}`;
            scannerResult.className = 'scanner-result error';
            scannerResult.style.display = 'block';
            updateScannerStatus('Hata oluÅŸtu', false);
        }
        
        document.getElementById('stockForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const barcodeInput = document.getElementById('barcode');
            const resultDiv = document.getElementById('result');
            const searchBtn = document.getElementById('searchBtn');
            
            const barcode = barcodeInput.value.trim();
            
            if (!barcode) {
                showResult('LÃ¼tfen geÃ§erli bir barkod numarasÄ± giriniz.', 'error');
                return;
            }
            
            // YÃ¼kleme durumunu gÃ¶ster
            searchBtn.disabled = true;
            searchBtn.textContent = 'â³ SorgulanÄ±yor...';
            showResult('<div class="spinner"></div><p>Stok Bilgileri Ã‡ekiliyor...</p>', 'loading');
            
            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ barcode: barcode })
                });
                
                const data = await response.json();
                
                console.log('ğŸ“¦ Gelen veri:', data); // Debug iÃ§in
                
                if (data.success) {
                    displayStockInfo(data);
                } else {
                    showResult(`âŒ Hata: ${data.error}<br>
                               ${data.url ? `<br>Manuel kontrol: <a href="${data.url}" target="_blank">${data.url}</a>` : ''}`, 'error');
                }
                
            } catch (error) {
                console.error('Fetch hatasÄ±:', error);
                showResult(`âŒ BaÄŸlantÄ± hatasÄ±: ${error.message}<br>
                           LÃ¼tfen Python Flask sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.`, 'error');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'ğŸ” Stok Sorgula';
            }
        });
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.className = type;
            resultDiv.style.display = 'block';
            
            // Hata durumlarÄ±nda baÅŸlÄ±ÄŸÄ± deÄŸiÅŸtirme (zaten deÄŸiÅŸmiyor)
            // if (type === 'error') {
            //     document.querySelector('h1').textContent = 'ğŸ›ï¸ Mudo Stok Sorgulama';
            // }
        }
        
        function displayStockInfo(data) {
            console.log('ğŸ” displayStockInfo - gelen veri:', data);
            console.log('ğŸ” product_info:', data.product_info);
            console.log('ğŸ” product_info.title:', data.product_info?.title);
            
            let html = '<div class="stock-info">';
            
            // GEÃ‡ERSÄ°Z BARKOD KONTROL SÄ°STEMÄ°
            let isInvalidBarcode = false;
            let invalidReason = '';
            
            // Kontrol 1: ÃœrÃ¼n baÅŸlÄ±ÄŸÄ± kontrolÃ¼
            const hasNoProductTitle = !data.product_info || !data.product_info.title || data.product_info.title.trim() === '';
            
            // Kontrol 2: Sadece Cevahir Giyim kontrolÃ¼ (kesin tespit)
            const hasOnlyCevahir = data.stock_data && data.stock_data.length === 1 && 
                                  data.stock_data[0].store.toLowerCase().includes('cevahir');
            
            // Kontrol 3: TÃ¼m maÄŸazalar Cevahir iÃ§eriyor mu?
            const allStoresAreCevahir = data.stock_data && data.stock_data.length > 0 && 
                                       data.stock_data.every(item => item.store.toLowerCase().includes('cevahir'));
            
            // Kontrol 4: HiÃ§ stok verisi yok
            const hasNoStockData = !data.stock_data || data.stock_data.length === 0;
            
            // ESAS KARAR MANTÄI
            if (hasOnlyCevahir || allStoresAreCevahir) {
                isInvalidBarcode = true;
                invalidReason = 'Sadece varsayÄ±lan maÄŸaza (Cevahir Giyim) gÃ¶steriliyor - Bu geÃ§ersiz barkod iÅŸareti';
            } else if (hasNoStockData) {
                isInvalidBarcode = true;
                invalidReason = 'HiÃ§ stok verisi yok';
            } else if (hasNoProductTitle && data.stock_data && data.stock_data.length > 0) {
                isInvalidBarcode = true;
                invalidReason = 'ÃœrÃ¼n baÅŸlÄ±ÄŸÄ± yok ama stok verisi var';
            }
            
            if (isInvalidBarcode) {
                // GeÃ§ersiz barkod durumunda baÅŸlÄ±ÄŸÄ± eski halinde bÄ±rak (zaten deÄŸiÅŸmiyor)
                // document.querySelector('h1').textContent = 'ğŸ›ï¸ Mudo Stok Sorgulama';
                showResult(`âŒ <strong>GeÃ§ersiz Barkod Tespit Edildi!</strong><br><br>
                           ğŸ” Barkod: <strong>"${document.getElementById('barcode').value}"</strong><br>
                           ğŸ“ Sebep: ${invalidReason}<br><br>
                           ğŸ¯ <strong>Ã‡Ã¶zÃ¼m:</strong><br>
                           â€¢ Barkod numarasÄ±nÄ± kontrol edin<br>
                           â€¢ ÃœrÃ¼nÃ¼n Mudo'da satÄ±ÅŸta olduÄŸundan emin olun<br>
                           â€¢ FarklÄ± bir barkod deneyin<br><br>
                           ğŸ’¡ <em>Not: Mudo sitesinde "AradÄ±ÄŸÄ±nÄ±z Ã¼rÃ¼n bulunamadÄ±" mesajÄ± Ã§Ä±kÄ±yorsa barkod geÃ§ersizdir.</em>`, 'error');
                return;
            }
            
            // ÃœrÃ¼n baÅŸlÄ±ÄŸÄ± ve detaylarÄ±
            if (data.product_info && data.product_info.title) {
                // Sayfa baÅŸlÄ±ÄŸÄ±nÄ± eski halinde bÄ±rak - deÄŸiÅŸtirme
                // document.querySelector('h1').textContent = `ğŸ“¦ ${data.product_info.title}`;
                
                // ÃœrÃ¼n ismini satÄ±ÅŸ fiyatÄ±nÄ±n Ã¼stÃ¼nde baÅŸlÄ±k olarak gÃ¶ster
                html += `<div class="product-title">ğŸ“¦ ${data.product_info.title}</div>`;
                
                // ÃœrÃ¼n detay bilgileri - sadece fiyat
                let productDetails = '';
                if (data.product_info.price) {
                    productDetails += `<span class="product-detail">ğŸ’° Fiyat: <strong>${data.product_info.price}</strong></span>`;
                }
                // Ä°ndirim bilgisini kaldÄ±r
                // if (data.product_info.discount) {
                //     productDetails += `<span class="product-detail discount">ğŸ·ï¸ ${data.product_info.discount}</span>`;
                // }
                
                if (productDetails) {
                    html += `<div class="product-details">${productDetails}</div>`;
                }
            }
            
            // Stok bilgileri
            if (data.stock_data && data.stock_data.length > 0) {
                html += '<h4>ğŸ“Š Stok Bilgileri:</h4>';
                
                // "concept alt grup" ile baÅŸlayan satÄ±rlarÄ± filtrele
                const filteredStockData = data.stock_data.filter(item => {
                    const storeName = item.store.toLowerCase();
                    return !storeName.includes('concept alt grup');
                });
                
                // Filtreleme sonrasÄ± hiÃ§ stok yoksa hata gÃ¶ster
                if (filteredStockData.length === 0) {
                    html += '</div>';
                    showResult('âŒ Bu Ã¼rÃ¼n iÃ§in stok bilgisi bulunamadÄ±. LÃ¼tfen barkod numarasÄ±nÄ± kontrol edin.', 'error');
                    return;
                }
                
                // Vadistanbul City iÃ§in kontrol
                const vadistanbulCityStore = filteredStockData.find(item => 
                    item.store.toLowerCase().includes('vadistanbul') && 
                    item.store.toLowerCase().includes('city')
                );
                
                // EÄŸer Vadistanbul City yoksa, 0 stoklÄ± olarak ekle
                if (!vadistanbulCityStore) {
                    filteredStockData.unshift({
                        store: "Vadistanbul City",
                        stock: "0",
                        is_priority: true,
                        no_stock: true
                    });
                }
                
                // Ã–nce Vadistanbul City'yi gÃ¶ster
                let priorityShown = false;
                let vadistanbulCityShown = false;
                let otherStoresHeaderAdded = false; // DiÄŸer maÄŸazalar baÅŸlÄ±ÄŸÄ±nÄ±n eklenip eklenmediÄŸini takip et
                
                filteredStockData.forEach((item, index) => {
                    const isPriority = item.is_priority || false;
                    const hasNoStock = item.no_stock || false;
                    const itemClass = isPriority ? 
                        (hasNoStock ? 'stock-item priority no-stock' : 'stock-item priority') : 
                        'stock-item';
                    const storeClass = isPriority ? 
                        (hasNoStock ? 'store-name priority no-stock' : 'store-name priority') : 
                        'store-name';
                    const stockClass = isPriority ? 
                        (hasNoStock ? 'stock-count priority no-stock' : 'stock-count priority') : 
                        'stock-count';
                    
                    // DiÄŸer maÄŸazalar baÅŸlÄ±ÄŸÄ±nÄ± sadece bir kez ekle
                    if (!isPriority && !otherStoresHeaderAdded) {
                        html += '<div style="margin: 20px 0; color: #374151; font-weight: 600; border-top: 3px solid #e5e7eb; padding-top: 18px; font-size: 1.1em;">ğŸ¬ DÄ°ÄER MAÄAZALAR</div>';
                        otherStoresHeaderAdded = true;
                    }
                    
                    // MaÄŸaza adÄ±ndan sadece sayÄ±larÄ± ve parantezleri kaldÄ±r
                    let cleanStoreName = item.store
                        .replace(/\s*\d+\s*/g, ' ') // SayÄ±larÄ± ve etrafÄ±ndaki boÅŸluklarÄ± kaldÄ±r
                        .replace(/\([^)]*\)/g, '') // Parantez ve iÃ§indeki herÅŸeyi kaldÄ±r
                        .replace(/\s+/g, ' ') // Ã‡oklu boÅŸluklarÄ± tek boÅŸluÄŸa Ã§evir
                        .trim(); // BaÅŸtaki ve sondaki boÅŸluklarÄ± kaldÄ±r
                    
                    const storeIcon = isPriority ? (hasNoStock ? 'âŒ ' : 'â­ ') : 'ğŸª ';
                    
                    html += `
                        <div class="${itemClass}">
                            <span class="${storeClass}">${storeIcon}${cleanStoreName}</span>
                            <span class="${stockClass}">${item.stock}</span>
                        </div>
                    `;
                    
                    // Vadistanbul City gÃ¶sterildikten hemen sonra beden seÃ§ici ekle
                    if (isPriority && !vadistanbulCityShown) {
                        vadistanbulCityShown = true;
                        priorityShown = true;
                        
                        // Debug: Beden bilgilerini console'a yazdÄ±r
                        console.log('ğŸ” Beden bilgileri kontrol ediliyor:', data.size_info);
                        console.log('ğŸ” DetaylÄ± kontrol:', {
                            'size_info_var': typeof data.size_info,
                            'success': data.size_info?.success,
                            'is_clothing': data.size_info?.is_clothing,
                            'sizes': data.size_info?.sizes,
                            'sizes_length': data.size_info?.sizes?.length
                        });
                        
                        // Varyant bilgilerini de kontrol et ve ekle
                        if (data.variants && data.variants.length > 0) {
                            console.log('ğŸ¨ Varyant bilgileri bulundu:', data.variants);
                            html += '</div>' + createVariantSelector(data.variants) + '<div class="stock-info">';
                        } else {
                            console.log('âš ï¸ Varyant bilgisi bulunamadÄ±');
                        }
                    }
                });
            } else {
                html += '</div>';
                showResult('âŒ Bu Ã¼rÃ¼n iÃ§in stok bilgisi bulunamadÄ±. LÃ¼tfen barkod numarasÄ±nÄ± kontrol edin veya Ã¼rÃ¼nÃ¼n sistemde kayÄ±tlÄ± olduÄŸundan emin olun.', 'error');
                return;
            }
            
            html += '</div>';
            
            showResult(html, 'success');
        }
        
        // Varyant seÃ§ici oluÅŸturma fonksiyonu
        function createVariantSelector(variants) {
            console.log('ğŸ¨ createVariantSelector Ã§aÄŸrÄ±ldÄ±, variants:', variants);
            
            // VaryantlarÄ± renklere gÃ¶re grupla
            const colorGroups = {};
            variants.forEach((variant, index) => {
                const color = variant.color;
                if (!colorGroups[color]) {
                    colorGroups[color] = [];
                }
                colorGroups[color].push({...variant, originalIndex: index});
            });
            
            let variantHtml = `
                <div class="variant-selector">
                    <h4>DiÄŸer Renk ve Beden SeÃ§enekleri</h4>
                    <div class="variant-buttons">
            `;
            
            // Her renk iÃ§in ayrÄ± grup oluÅŸtur
            Object.keys(colorGroups).forEach(color => {
                const colorVariants = colorGroups[color];
                
                variantHtml += `
                    <div class="color-group">
                        <div class="color-group-title">ğŸ¨ ${color}</div>
                        <div class="size-buttons-row">
                `;
                
                colorVariants.forEach(variant => {
                    console.log(`ğŸ¨ Varyant butonu oluÅŸturuluyor: ${variant.size} (${variant.barcode})`);
                    
                    variantHtml += `
                        <button type="button" class="variant-button" onclick="selectVariant('${variant.barcode}', '${variant.display_name}', ${variant.originalIndex})">
                            <div class="variant-size">${variant.size}</div>
                            <div class="variant-barcode">${variant.barcode.slice(-4)}</div>
                        </button>
                    `;
                });
                
                variantHtml += `
                        </div>
                    </div>
                `;
            });
            
            variantHtml += `
                    </div>
                </div>
            `;
            
            return variantHtml;
        }
        
        // Varyant seÃ§imi fonksiyonu
        function selectVariant(barcode, displayName, originalIndex) {
            console.log(`ğŸ¨ Varyant seÃ§ildi: ${displayName} (${barcode})`);
            
            // SeÃ§ili varyant butonunu vurgula - tÃ¼m butonlarÄ± kontrol et
            document.querySelectorAll('.variant-button').forEach((btn, i) => {
                // TÄ±klanan butonu bul (barkod ile karÅŸÄ±laÅŸtÄ±r)
                const btnBarcode = btn.onclick.toString().match(/'(\d+)'/);
                if (btnBarcode && btnBarcode[1] === barcode) {
                    btn.classList.add('selected');
                    console.log(`âœ… Buton seÃ§ili olarak iÅŸaretlendi: ${displayName}`);
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            // Barkod input'una yeni barkod numarasÄ±nÄ± yaz
            const barcodeInput = document.getElementById('barcode');
            const oldBarcode = barcodeInput.value;
            barcodeInput.value = barcode;
            
            console.log(`ğŸ”„ Barkod deÄŸiÅŸtirildi: ${oldBarcode} â†’ ${barcode}`);
            
            // Yeni barkod ile otomatik stok sorgusu baÅŸlat
            setTimeout(() => {
                console.log('ğŸš€ Otomatik stok sorgusu baÅŸlatÄ±lÄ±yor...');
                document.getElementById('stockForm').dispatchEvent(new Event('submit'));
            }, 500);
        }
        
        // Barkod input eventi - 13 basamak tamamlandÄ±ÄŸÄ±nda otomatik sorgu
        document.getElementById('barcode').addEventListener('input', function(e) {
            const value = e.target.value;
            
            // 13 basamak tamamlandÄ±ÄŸÄ±nda otomatik sorgu baÅŸlat
            if (value.length === 13) {
                // KÄ±sa bir gecikme ekleyerek kullanÄ±cÄ±nÄ±n son rakamÄ± gÃ¶rmesini saÄŸla
                setTimeout(() => {
                    document.getElementById('stockForm').dispatchEvent(new Event('submit'));
                }, 300);
            }
        });
        
        // Enter tuÅŸu ile form gÃ¶nderimi
        document.getElementById('barcode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('stockForm').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>
